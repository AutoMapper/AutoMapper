(function(e){if(typeof bootstrap=="function")bootstrap("promise",e);else if(typeof exports=="object")e(void 0,exports);else if(typeof define=="function")define(e);else if(typeof ses!="undefined"){if(!ses.ok())return;ses.makeQ=function(){var t={};return e(void 0,t)}}else e(void 0,Q={})})(function(e,t){"use strict";function b(e){return y(e)==="[object StopIteration]"||e instanceof w}function E(e,t){var n=[];try{n.push(e.toString())}catch(r){try{n.push("<error: "+r+">")}catch(i){n.push("<error>")}}for(var s=0;s<t.length;s++){var o=t[s],u;if(typeof o=="string")n.push(o);else{try{u=S(o)}catch(r){try{u="<error: "+r+">"}catch(i){u="<error>"}}n.push("    at "+u)}}return n.join("\n")}function S(e){var t="";if(e.isNative())t="native";else if(e.isEval())t="eval at "+e.getEvalOrigin();else{var n=e.getFileName();if(n){t+=n;var r=e.getLineNumber();if(r!==null){t+=":"+r;var i=e.getColumnNumber();i&&(t+=":"+i)}}}t||(t="unknown source");var s="",o=e.getFunction().name,u=!0,a=e.isConstructor(),f=!e.isToplevel()&&!a;if(f){var l=e.getMethodName();s+=e.getTypeName()+".",o?(s+=o,l&&l!==o&&(s+=" [as "+l+"]")):s+=l||"<anonymous>"}else a?s+="new "+(o||"<anonymous>"):o?s+=o:(s+=t,u=!1);return u&&(s+=" ("+t+")"),s}function x(e,t){if(e!==r)return!1;var i=t.getLineNumber();return i>=n&&i<=wt}function T(e){var t=Error.prepareStackTrace;Error.prepareStackTrace=function(e,t){return t.filter(function(e){var t=e.getFileName();return t!=="module.js"&&t!=="node.js"&&!x(t,e)})};var n=e.stack;return Error.prepareStackTrace=t,n}function N(){if(Error.captureStackTrace){var e,t,n=Error.prepareStackTrace;return Error.prepareStackTrace=function(n,r){e=r[1].getFileName(),t=r[1].getLineNumber()},(new Error).stack,Error.prepareStackTrace=n,r=e,t}}function C(e,t,n){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn(t+" is deprecated, use "+n+" instead.",(new Error("")).stack),e.apply(e,arguments)}}function k(){function u(r){if(!e)return;n=q(r),p(e,function(e,t){o(function(){n.promiseSend.apply(n,t)})},void 0),e=void 0,t=void 0}var e=[],t=[],n,r=m(k.prototype),i=m(A.prototype);return i.promiseSend=function(r,i,s,u){var a=h(arguments);e?(e.push(a),r==="when"&&u&&t.push(u)):o(function(){n.promiseSend.apply(n,a)})},i.valueOf=function(){return e?i:n.valueOf()},Error.captureStackTrace&&Error.captureStackTrace(i,k),s(i),r.promise=i,r.resolve=u,r.reject=function(e){u(I(e))},r.notify=function(n){e&&p(t,function(e,t){o(function(){t(n)})},void 0)},r}function L(e){var t=k();return rt(e,t.resolve,t.reject,t.notify).fail(t.reject),t.promise}function A(e,t,n,r){t===void 0&&(t=function(e){return I(new Error("Promise does not support operation: "+e))});var i=m(A.prototype);return i.promiseSend=function(n,r){var s=h(arguments,2),o;try{e[n]?o=e[n].apply(i,s):o=t.apply(i,[n].concat(s))}catch(u){o=I(u)}r&&r(o)},n&&(i.valueOf=n),r&&(i.exception=r),s(i),i}function O(e){return Object(e)!==e?e:M(e)?e.valueOf():e}function M(e){return e&&typeof e.promiseSend=="function"}function _(e){return D(e)||P(e)}function D(e){return!M(O(e))}function P(e){return e=O(e),M(e)&&"exception"in e}function F(){!j&&typeof window!="undefined"&&!window.Touch&&window.console&&console.log("Should be empty:",B),j=!0}function I(e){e=e||new Error;var t=A({when:function(t){if(t){var n=d(H,this);n!==-1&&(B.splice(n,1),H.splice(n,1))}return t?t(e):I(e)}},function(){return I(e)},function n(){return this},e);return F(),H.push(t),B.push(e),t}function q(e){if(M(e))return e;e=O(e);if(e&&typeof e.then=="function"){var t=k();return e.then(t.resolve,t.reject,t.notify),t.promise}return A({when:function(){return e},get:function(t){return e[t]},put:function(t,n){return e[t]=n,e},del:function(t){return delete e[t],e},post:function(t,n){return e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},fapply:function(t){return e.apply(void 0,t)},viewInfo:function(){function r(e){n[e]||(n[e]=typeof t[e])}var t=e,n={};while(t)Object.getOwnPropertyNames(t).forEach(r),t=Object.getPrototypeOf(t);return{type:typeof e,properties:n}},keys:function(){return g(e)}},void 0,function n(){return e})}function R(e){return A({isDef:function(){}},function(){var n=h(arguments);return Q.apply(void 0,[e].concat(n))},function(){return O(e)})}function U(e,t){return e=q(e),t?A({viewInfo:function(){return t}},function(){var n=h(arguments);return Q.apply(void 0,[e].concat(n))},function(){return O(e)}):Q(e,"viewInfo")}function z(e){return U(e).when(function(t){var n;t.type==="function"?n=function(){return et(e,void 0,arguments)}:n={};var r=t.properties||{};return g(r).forEach(function(t){r[t]==="function"&&(n[t]=function(){return Z(e,t,arguments)})}),q(n)})}function W(e,t,n,r){function u(e){try{return t?t(e):e}catch(n){return I(n)}}function a(e){try{return n?n(e):I(e)}catch(t){return I(t)}}function f(e){return r?r(e):e}var i=k(),s=!1,l=q(e);return o(function(){l.promiseSend("when",function(e){if(s)return;s=!0,i.resolve(u(e))},function(e){if(s)return;s=!0,i.resolve(a(e))})}),l.promiseSend("when",void 0,void 0,function(e){i.notify(f(e))}),i.promise}function X(e,t,n){return W(e,function(e){return ot(e).then(function(e){return t.apply(void 0,e)},n)},n)}function V(e){return function(){function t(e,t){var s;try{s=n[e](t)}catch(o){return b(o)?o.value:I(o)}return W(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"send"),i=t.bind(t,"throw");return r()}}function $(e){throw new w(e)}function J(e){return function(){return ot([this,ot(arguments)]).spread(function(t,n){return e.apply(t,n)})}}function K(e){return function(t){var n=h(arguments,1);return Q.apply(void 0,[t,e].concat(n))}}function Q(e,t){var n=k(),r=h(arguments,2);return e=q(e),o(function(){e.promiseSend.apply(e,[t,n.resolve].concat(r))}),n.promise}function G(e,t,n){var r=k();return e=q(e),o(function(){e.promiseSend.apply(e,[t,r.resolve].concat(n))}),r.promise}function Y(e){return function(t){var n=h(arguments,1);return G(t,e,n)}}function nt(e,t){var n=h(arguments,2);return et(e,t,n)}function rt(e){var t=h(arguments,1);return tt(e,t)}function it(e,t){var n=h(arguments,2);return function(){var i=n.concat(h(arguments));return et(e,t,i)}}function st(e){var t=h(arguments,1);return function(){var r=t.concat(h(arguments));return tt(e,r)}}function ot(e){return W(e,function(e){var t=e.length;if(t===0)return q(e);var n=k();return p(e,function(r,i,s){D(i)?(e[s]=O(i),--t===0&&n.resolve(e)):W(i,function(r){e[s]=r,--t===0&&n.resolve(e)}).fail(n.reject)},void 0),n.promise})}function ut(e){return W(e,function(e){return W(ot(v(e,function(e){return W(e,i,i)})),function(){return v(e,q)})})}function at(e,t){return W(e,void 0,t)}function ft(e,t){return W(e,void 0,void 0,t)}function lt(e,t){return W(e,function(e){return W(t(),function(){return e})},function(e){return W(t(),function(){return I(e)})})}function ct(e,n,r,i){function s(n){o(function(){var r;if(Error.captureStackTrace&&typeof n=="object"&&(r=T(n))){var i=T(e);if(typeof r!="string"){var s=r.concat("From previous event:",i);n.stack=E(n,s)}}if(!t.onerror)throw n;t.onerror(n)})}var u=n||r||i?W(e,n,r,i):e;at(u,s)}function ht(e,t){var n=k(),r=setTimeout(function(){n.reject(new Error("Timed out after "+t+" ms"))},t);return W(e,function(e){clearTimeout(r),n.resolve(e)},n.reject),n.promise}function pt(e,t){t===void 0&&(t=e,e=void 0);var n=k();return setTimeout(function(){n.resolve(e)},t),n.promise}function dt(e,t,n){return mt(e,t).apply(void 0,n)}function vt(e,t){var n=h(arguments,2);return dt(e,t,n)}function mt(e){if(arguments.length>1){var t=arguments[1],n=h(arguments,2),r=e;e=function(){var e=n.concat(h(arguments));return r.apply(t,e)}}return function(){var t=k(),n=h(arguments);return n.push(t.makeNodeResolver()),tt(e,n).fail(t.reject),t.promise}}function gt(e,t,n){var r=h(n),i=k();return r.push(i.makeNodeResolver()),Z(e,t,r).fail(i.reject),i.promise}function yt(e,t){var n=h(arguments,2),r=k();return n.push(r.makeNodeResolver()),Z(e,t,n).fail(r.reject),r.promise}function bt(e,t){if(!t)return e;e.then(function(e){o(function(){t(null,e)})},function(e){o(function(){t(e)})})}var n=N(),r,i=function(){},s=Object.freeze||i;typeof cajaVM!="undefined"&&(s=cajaVM.def);var o;if(typeof process!="undefined")o=process.nextTick;else if(typeof setImmediate=="function")o=setImmediate;else if(typeof MessageChannel!="undefined"){var u=new MessageChannel,a={},f=a;u.port1.onmessage=function(){a=a.next;var e=a.task;delete a.task,e()},o=function(e){f=f.next={task:e},u.port2.postMessage(0)}}else o=function(e){setTimeout(e,0)};var l;if(Function.prototype.bind){var c=Function.prototype.bind;l=c.bind(c.call)}else l=function(e){return function(){return e.call.apply(e,arguments)}};var h=l(Array.prototype.slice),p=l(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1)do{if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}while(1);for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),d=l(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),v=l(Array.prototype.map||function(e,t){var n=this,r=[];return p(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),m=Object.create||function(e){function t(){}return t.prototype=e,new t},g=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},y=Object.prototype.toString,w;typeof ReturnValue!="undefined"?w=ReturnValue:w=function(e){this.value=e},t.nextTick=o,t.defer=k,k.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(h(arguments,1)):e.resolve(n)}},k.prototype.node=C(k.prototype.makeNodeResolver,"node","makeNodeResolver"),t.promise=L,t.makePromise=A,A.prototype.then=function(e,t,n){return W(this,e,t,n)},A.prototype.thenResolve=function(e){return W(this,function(){return e})},p(["isResolved","isFulfilled","isRejected","when","spread","send","get","put","del","post","invoke","keys","apply","call","bind","fapply","fcall","fbind","all","allResolved","view","viewInfo","timeout","delay","catch","finally","fail","fin","progress","end","done","ncall","napply","nbind","npost","ninvoke","nend","nodeify"],function(e,n){A.prototype[n]=function(){return t[n].apply(t,[this].concat(h(arguments)))}},void 0),A.prototype.toSource=function(){return this.toString()},A.prototype.toString=function(){return"[object Promise]"},s(A.prototype),t.nearer=O,t.isPromise=M,t.isResolved=_,t.isFulfilled=D,t.isRejected=P;var H=[],B=[],j;t.reject=I,t.begin=q,t.resolve=q,t.ref=C(q,"ref","resolve"),t.master=R,t.viewInfo=U,t.view=z,t.when=W,t.spread=X,t.async=V,t["return"]=$,t.promised=J,t.sender=C(K,"sender","dispatcher"),t.Method=C(K,"Method","dispatcher"),t.send=C(Q,"send","dispatch"),t.dispatch=G,t.dispatcher=Y,t.get=Y("get"),t.put=Y("put"),t["delete"]=t.del=Y("del");var Z=t.post=Y("post");t.invoke=function(e,t){var n=h(arguments,2);return Z(e,t,n)};var et=t.apply=C(Y("apply"),"apply","fapply"),tt=t.fapply=Y("fapply");t.call=C(nt,"call","fcall"),t["try"]=rt,t.fcall=rt,t.bind=C(it,"bind","fbind"),t.fbind=st,t.keys=Y("keys"),t.all=ot,t.allResolved=ut,t["catch"]=t.fail=at,t.progress=ft,t["finally"]=t.fin=lt,t.end=C(ct,"end","done"),t.done=ct,t.timeout=ht,t.delay=pt,t.napply=dt,t.ncall=vt,t.nbind=mt,t.npost=gt,t.ninvoke=yt,t.nend=C(bt,"nend","nodeify"),t.nodeify=bt;var wt=N()});